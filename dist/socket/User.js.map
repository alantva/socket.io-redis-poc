{"version":3,"sources":["../../server/socket/User.js"],"names":["module","exports","namespaces","user","on","socket","client","partner","id","data","console","log","name","customer","to","socketID","emit"],"mappings":";;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;;;AAMAA,OAAOC,OAAP,GAAiB,UAACC,UAAD,EAAgB;AAC/BA,aAAWC,IAAX,CAAgBC,EAAhB,CAAmB,YAAnB;AAAA,wFAAiC,iBAAOC,MAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAEV,2BAAmBA,MAAnB,CAFU;;AAAA;AAEzBC,oBAFyB;AAAA;AAAA,qBAIzB,iBAAUA,MAAV,CAJyB;;AAAA;AAAA;AAAA,qBAMT,6BAAqBA,MAArB,CANS;;AAAA;AAMzBC,qBANyB;;AAAA,mBAQ3BA,OAR2B;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAUvB,mBAAYD,MAAZ,CAVuB;;AAAA;AAAA;AAAA,qBAavB,2BAAmB,CAACA,OAAOE,EAAR,EAAYD,QAAQC,EAApB,CAAnB,CAbuB;;AAAA;;AAgB/BH,qBAAOD,EAAP,CAAU,SAAV,EAAqB,UAACK,IAAD,EAAU;AAC7BC,wBAAQC,GAAR,kBAA2BL,OAAOM,IAAlC,4BAD6B,CACmC;AAChEV,2BAAWW,QAAX,CAAoBC,EAApB,CAAuBP,QAAQQ,QAA/B,EAAyCC,IAAzC,CAA8C,SAA9C,EAAyDP,IAAzD;AACAJ,uBAAOW,IAAP,CAAY,SAAZ,EAAuBP,IAAvB;AACD,eAJD;;AAMAJ,qBAAOD,EAAP,CAAU,YAAV,EAAwB,YAAM;AAC5BM,wBAAQC,GAAR,kBAA2BL,OAAOM,IAAlC,0BAD4B,CACkC;AAC9D,oBAAI,oBAAaN,MAAb,CAAJ,EAA0B;AACxBI,0BAAQC,GAAR,kBAA2BL,OAAOM,IAAlC,sCADwB,CACkD;AAC3E;AACD,oBAAI,mBAAYN,MAAZ,CAAJ,EAAyB;AACvBI,0BAAQC,GAAR,kBAA2BL,OAAOM,IAAlC,8CADuB,CAC2D;AACnF;AACD,oBAAI,kBAAW,CAACN,OAAOE,EAAR,CAAX,CAAJ,EAA6B;AAC3BE,0BAAQC,GAAR,kBAA2BL,OAAOM,IAAlC,8CAD2B,CACuD;AACnF;AACF,eAXD;;AAtB+B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAjC;;AAAA;AAAA;AAAA;AAAA;AAmCD,CApCD","file":"User.js","sourcesContent":["import { remove as ClientRemove } from './Client.Redis';\nimport { push as QueuePush, remove as QueueRemove } from './Queue.Redis';\nimport { remove as RoomRemove } from './Room.Redis';\nimport {\n  saveRegister as ClientSaveRegister,\n  assignPartners as ClientAssignPartners,\n  assignToRoom as ClientAssignToRoom,\n} from './Client';\n\nmodule.exports = (namespaces) => {\n  namespaces.user.on('connection', async (socket) => {\n    /* Register a client */\n    const client = await ClientSaveRegister(socket);\n    /* Assign the client to a queue */\n    await QueuePush(client);\n    /* Assign the client to partner */\n    const partner = await ClientAssignPartners(client);\n\n    if (partner) {\n      /* Unassign the client to a queue */\n      await QueueRemove(client);\n\n      /* Assign the client and the partner to a room */\n      await ClientAssignToRoom([client.id, partner.id]);\n    }\n\n    socket.on('message', (data) => {\n      console.log(`\\nUSER Bot: ${client.name} enviou uma mensagem.`); // eslint-disable-line\n      namespaces.customer.to(partner.socketID).emit('message', data);\n      socket.emit('message', data);\n    });\n\n    socket.on('disconnect', () => {\n      console.log(`\\nUSER Bot: ${client.name} se desconectou. :(`); // eslint-disable-line\n      if (ClientRemove(client)) {\n        console.log(`\\nUSER Bot: ${client.name} teve seu registro removido. :)`); // eslint-disable-line\n      }\n      if (QueueRemove(client)) {\n        console.log(`\\nUSER Bot: ${client.name} teve seu registro removido da fila. :)`); // eslint-disable-line\n      }\n      if (RoomRemove([client.id])) {\n        console.log(`\\nUSER Bot: ${client.name} teve seu registro removido da sala. :)`); // eslint-disable-line\n      }\n    });\n  });\n};\n"]}