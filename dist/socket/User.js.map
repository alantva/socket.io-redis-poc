{"version":3,"sources":["../../server/socket/User.js"],"names":["module","exports","namespaces","user","on","socket","client","partner","data","console","log","name","customer","to","socketID","emit"],"mappings":";;;;;;;;;;AAAA;;AACA;;AACA;;;;AAKAA,OAAOC,OAAP,GAAiB,UAACC,UAAD,EAAgB;AAC/BA,aAAWC,IAAX,CAAgBC,EAAhB,CAAmB,YAAnB;AAAA,wFAAiC,iBAAOC,MAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAEV,2BAAmBA,MAAnB,CAFU;;AAAA;AAEzBC,oBAFyB;AAAA;AAAA,qBAIzB,iBAAUA,MAAV,CAJyB;;AAAA;AAAA;AAAA,qBAMT,4BAAoBA,MAApB,CANS;;AAAA;AAMzBC,qBANyB;;AAAA,mBAQ3BA,OAR2B;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAUvB,mBAAYD,MAAZ,CAVuB;;AAAA;;AAY7BD,qBAAOD,EAAP,CAAU,SAAV,EAAqB,UAACI,IAAD,EAAU;AAC7BC,wBAAQC,GAAR,kBAA2BJ,OAAOK,IAAlC,4BAD6B,CACmC;AAChET,2BAAWU,QAAX,CAAoBC,EAApB,CAAuBN,QAAQO,QAA/B,EAAyCC,IAAzC,CAA8C,SAA9C,EAAyDP,IAAzD,EAA+D,YAAM;AACnEC,0BAAQC,GAAR,CAAY,MAAZ,EADmE,CAC9C;AACtB,iBAFD;AAGAL,uBAAOU,IAAP,CAAY,SAAZ,EAAuBP,IAAvB,EAA6B,YAAM;AACjCC,0BAAQC,GAAR,CAAY,OAAZ,EADiC,CACX;AACvB,iBAFD;AAGD,eARD;;AAZ6B;;AAuB/BL,qBAAOD,EAAP,CAAU,YAAV,EAAwB,YAAM;AAC5BK,wBAAQC,GAAR,kBAA2BJ,OAAOK,IAAlC,0BAD4B,CACkC;AAC9D,oBAAI,oBAAaL,MAAb,CAAJ,EAA0B;AACxBG,0BAAQC,GAAR,kBAA2BJ,OAAOK,IAAlC,sCADwB,CACkD;AAC3E;AACD,oBAAI,mBAAYL,MAAZ,CAAJ,EAAyB;AACvBG,0BAAQC,GAAR,sBAA+BJ,OAAOK,IAAtC,8CADuB,CAC+D;AACvF;AACF,eARD;;AAvB+B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAjC;;AAAA;AAAA;AAAA;AAAA;AAiCD,CAlCD","file":"User.js","sourcesContent":["import { remove as ClientRemove } from './Client.Redis';\nimport { push as QueuePush, remove as QueueRemove } from './Queue.Redis';\nimport {\n  saveRegister as ClientSaveRegister,\n  assignPartner as ClientAssignPartner,\n} from './Client';\n\nmodule.exports = (namespaces) => {\n  namespaces.user.on('connection', async (socket) => {\n    /* Register a client */\n    const client = await ClientSaveRegister(socket);\n    /* Assign the client to a queue */\n    await QueuePush(client);\n    /* Assign the client to partner */\n    const partner = await ClientAssignPartner(client);\n\n    if (partner) {\n      /* Unassign the client to a queue */\n      await QueueRemove(client);\n\n      socket.on('message', (data) => {\n        console.log(`\\nUSER Bot: ${client.name} enviou uma mensagem.`); // eslint-disable-line\n        namespaces.customer.to(partner.socketID).emit('message', data, () => {\n          console.log('PAU!'); // eslint-disable-line\n        });\n        socket.emit('message', data, () => {\n          console.log('PIRU!'); // eslint-disable-line\n        });\n      });\n    }\n\n    socket.on('disconnect', () => {\n      console.log(`\\nUSER Bot: ${client.name} se desconectou. :(`); // eslint-disable-line\n      if (ClientRemove(client)) {\n        console.log(`\\nUSER Bot: ${client.name} teve seu registro removido. :)`); // eslint-disable-line\n      }\n      if (QueueRemove(client)) {\n        console.log(`\\nCUSTOMER Bot: ${client.name} teve seu registro removido da fila. :)`); // eslint-disable-line\n      }\n    });\n  });\n};\n"]}