{"version":3,"sources":["../../server/socket/Customer.js"],"names":["module","exports","namespaces","customer","on","socket","client","partner","id","data","console","log","name","user","to","socketID","emit"],"mappings":";;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;;;AAMAA,OAAOC,OAAP,GAAiB,UAACC,UAAD,EAAgB;AAC/BA,aAAWC,QAAX,CAAoBC,EAApB,CAAuB,YAAvB;AAAA,wFAAqC,iBAAOC,MAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAEd,2BAAmBA,MAAnB,CAFc;;AAAA;AAE7BC,oBAF6B;AAAA;AAAA,qBAI7B,iBAAUA,MAAV,CAJ6B;;AAAA;AAAA;AAAA,qBAMb,6BAAqBA,MAArB,CANa;;AAAA;AAM7BC,qBAN6B;;AAAA,mBAQ/BA,OAR+B;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAU3B,mBAAYD,MAAZ,CAV2B;;AAAA;AAAA;AAAA,qBAa3B,2BAAmB,CAACA,OAAOE,EAAR,EAAYD,QAAQC,EAApB,CAAnB,CAb2B;;AAAA;;AAgBnCH,qBAAOD,EAAP,CAAU,SAAV,EAAqB,UAACK,IAAD,EAAU;AAC7BC,wBAAQC,GAAR,sBAA+BL,OAAOM,IAAtC,4BAD6B,CACuC;AACpEV,2BAAWW,IAAX,CAAgBC,EAAhB,CAAmBP,QAAQQ,QAA3B,EAAqCC,IAArC,CAA0C,SAA1C;AACAX,uBAAOW,IAAP,CAAY,SAAZ,EAAuBP,IAAvB;AACD,eAJD;;AAMAJ,qBAAOD,EAAP,CAAU,YAAV,EAAwB,YAAM;AAC5BM,wBAAQC,GAAR,sBAA+BL,OAAOM,IAAtC,0BAD4B,CACsC;AAClE,oBAAI,oBAAaN,MAAb,CAAJ,EAA0B;AACxBI,0BAAQC,GAAR,sBAA+BL,OAAOM,IAAtC,sCADwB,CACsD;AAC/E;AACD,oBAAI,mBAAYN,MAAZ,CAAJ,EAAyB;AACvBI,0BAAQC,GAAR,sBAA+BL,OAAOM,IAAtC,8CADuB,CAC+D;AACvF;AACD,oBAAI,kBAAW,CAACN,OAAOE,EAAR,CAAX,CAAJ,EAA6B;AAC3BE,0BAAQC,GAAR,sBAA+BL,OAAOM,IAAtC,8CAD2B,CAC2D;AACvF;AACF,eAXD;;AAtBmC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAArC;;AAAA;AAAA;AAAA;AAAA;AAmCD,CApCD","file":"Customer.js","sourcesContent":["import { remove as ClientRemove } from './Client.Redis';\nimport { push as QueuePush, remove as QueueRemove } from './Queue.Redis';\nimport { remove as RoomRemove } from './Room.Redis';\nimport {\n  saveRegister as ClientSaveRegister,\n  assignPartners as ClientAssignPartners,\n  assignToRoom as ClientAssignToRoom,\n} from './Client';\n\nmodule.exports = (namespaces) => {\n  namespaces.customer.on('connection', async (socket) => {\n    /* Register a client */\n    const client = await ClientSaveRegister(socket);\n    /* Assign the client to a queue */\n    await QueuePush(client);\n    /* Assign the client to a partner */\n    const partner = await ClientAssignPartners(client);\n\n    if (partner) {\n      /* Unassign the client to a queue */\n      await QueueRemove(client);\n\n      /* Assign the client and the partner to a room */\n      await ClientAssignToRoom([client.id, partner.id]);\n    }\n\n    socket.on('message', (data) => {\n      console.log(`\\nCUSTOMER Bot: ${client.name} enviou uma mensagem.`); // eslint-disable-line\n      namespaces.user.to(partner.socketID).emit('message');\n      socket.emit('message', data);\n    });\n\n    socket.on('disconnect', () => {\n      console.log(`\\nCUSTOMER Bot: ${client.name} se desconectou. :(`); // eslint-disable-line\n      if (ClientRemove(client)) {\n        console.log(`\\nCUSTOMER Bot: ${client.name} teve seu registro removido. :)`); // eslint-disable-line\n      }\n      if (QueueRemove(client)) {\n        console.log(`\\nCUSTOMER Bot: ${client.name} teve seu registro removido da fila. :)`); // eslint-disable-line\n      }\n      if (RoomRemove([client.id])) {\n        console.log(`\\nCUSTOMER Bot: ${client.name} teve seu registro removido da sala. :)`); // eslint-disable-line\n      }\n    });\n  });\n};\n"]}