{"version":3,"sources":["../../server/socket/Client.Redis.js"],"names":["Redis","port","process","env","REDIS_PORT","host","REDIS_URL","get","data","id","type","Promise","resolve","reject","hgetall","err","result","set","name","socketID","hmset","remove","del","clear","keys","e","pipeline","forEach","key","exec","console","log"],"mappings":"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","file":"Client.Redis.js","sourcesContent":["import IORedis from 'ioredis';\n\nconst Redis = new IORedis({\n  port: process.env.REDIS_PORT,\n  host: process.env.REDIS_URL,\n});\n\nconst get = (data) => {\n  const { id, type } = data;\n  return new Promise((resolve, reject) => {\n    Redis.hgetall(`w-api:client:${type}:${id}`, (err, result) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(result);\n      }\n    });\n  });\n};\nconst set = async (data) => {\n  const { id, name, type, socketID } = data; // eslint-disable-line\n  return new Promise((resolve, reject) => {\n    Redis.hmset(`w-api:client:${type}:${id}`, [\n      'id',\n      id,\n      'name',\n      name,\n      'type',\n      type,\n      'socketID',\n      socketID,\n    ], (err) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve();\n      }\n    });\n  });\n};\nconst remove = (data) => {\n  const { id, type } = data;\n  return new Promise((resolve, reject) => {\n    Redis.del(`w-api:client:${type}:${id}`, (err) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve();\n      }\n    });\n  });\n};\nconst clear = () => new Promise((resolve, reject) => {\n  Redis.keys('w-api:client:*', (e, keys) => {\n    if (e) {\n      reject(e);\n    } else {\n      const pipeline = Redis.pipeline();\n      keys.forEach((key) => {\n        pipeline.del(key);\n      });\n      pipeline.exec((err) => {\n        if (err) {\n          reject(err);\n        } else {\n          console.log('Client.Redis: Redis client clear!'); // eslint-disable-line\n          resolve();\n        }\n      });\n    }\n  });\n});\n\nexport {\n  set,\n  get,\n  remove,\n  clear,\n};\n"]}