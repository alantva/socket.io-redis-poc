{"version":3,"sources":["../../server/socket/Client.Redis.js"],"names":["Redis","port","process","env","REDIS_PORT","host","REDIS_URL","get","data","id","type","Promise","resolve","reject","hgetall","err","result","set","name","socketID","roomID","hmset","remove","del","clear","keys","e","pipeline","forEach","key","exec","console","log"],"mappings":"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","file":"Client.Redis.js","sourcesContent":["import IORedis from 'ioredis';\n\nconst Redis = new IORedis({\n  port: process.env.REDIS_PORT,\n  host: process.env.REDIS_URL,\n});\n\nconst get = (data) => {\n  const { id, type } = data;\n  return new Promise((resolve, reject) => {\n    Redis.hgetall(`w-api:client:${type}:${id}`, (err, result) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(result);\n      }\n    });\n  });\n};\nconst set = async (data) => {\n  const { id, name, type, socketID, roomID } = data; // eslint-disable-line\n  return new Promise((resolve, reject) => {\n    Redis.hmset(`w-api:client:${type}:${id}`, [\n      'id',\n      id,\n      'name',\n      name,\n      'type',\n      type,\n      'socketID',\n      socketID,\n      'roomID',\n      roomID,\n    ], (err) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve();\n      }\n    });\n  });\n};\nconst remove = (data) => {\n  const { id, type } = data;\n  return new Promise((resolve, reject) => {\n    Redis.del(`w-api:client:${type}:${id}`, (err) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve();\n      }\n    });\n  });\n};\nconst clear = () => new Promise((resolve, reject) => {\n  Redis.keys('w-api:client:*', (e, keys) => {\n    if (e) {\n      reject(e);\n    } else {\n      const pipeline = Redis.pipeline();\n      keys.forEach((key) => {\n        pipeline.del(key);\n      });\n      pipeline.exec((err) => {\n        if (err) {\n          reject(err);\n        } else {\n          console.log('Client.Redis: Redis client clear!'); // eslint-disable-line\n          resolve();\n        }\n      });\n    }\n  });\n});\n\nexport {\n  set,\n  get,\n  remove,\n  clear,\n};\n"]}